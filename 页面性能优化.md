自学前端以来，“如何进行页面性能优化”，“怎样使页面加载速度更快”……类似的文案看过听过不少。同时解决这类问题的方案也不少，譬如使用雪碧图，减少http请求，cdn，代码合并压缩等等。至于为什么这样做可以加快页面加载速度，我一直不太清楚，这也让我一度苦恼。好吧，我就随便哔哔几句，下面正式开始说页面性能优化的问题，如有错误欢迎指正。

解决一个问题前，肯定得先明白导致这个问题的原因是什么？

首先，我们需要了解，在浏览器中输入一个url至页面呈现在用户面前 这一过程到底发生了什么？这个过程在这就不阐述，需要了解的同学请点击[这里](https://www.jianshu.com/p/c1dfc6caa520)。

在整个过程中仅有10%~20%的时间耗费在***DNS域名解析至接收响应结果(即html文档)***这一过程中，80%~90%的时间耗费在解析html请求下载相关资源上面。

![](https://github.com/shaniawei/resource/blob/master/images/7.png)

由此图可以看出，每请求下载一个资源都需要耗费一定的时间，所以这是不是意味着如果一个网页需要请求下载的资源越少那么整个过程耗费的时间就越短呢？同时如果请求下载某个资源所需的时间越少是不是也意味着整个过程耗费的时间越短呢？既如此，怎样加快页面加载速度的大方向就确定了。

**第一，减少请求下载资源的数量，即减少http请求数；**

可从以下几个方面减少http请求数。

- 图片

  - 图片地图

    图片地图适用于网页的导航条部分(图片元素)。有时候网页的导航条部分使用的是视觉感受更好的图片元素而不是单纯的文字，点击不同的图片进入到对应的页面。假设某个网页的导航条有四个部分，那么对应的就有四张图片，既如此就会产生4个http请求。

    使用图片地图的方式，可以把这四张图拼成一张图，利用area标签设置图片的热点区域进行相应的跳转。这样的话，http请求数从4个变成1个。

    **图片地图的优点**

    **图片地图的缺点**

    ```HTML
    <img src="planets.jpg" border="0" usemap="#planetmap" alt="Planets" />

    <map name="planetmap" id="planetmap">

      <area shape="circle" coords="180,139,14" href ="venus.html" alt="Venus" />

      <area shape="circle" coords="129,161,10" href ="mercur.html" alt="Mercury" />

      <area shape="rect" coords="0,0,110,260" href ="sun.html" alt="Sun" />

    </map>

    ```

    ​

  - 雪碧图

    一个网页中总会有一些小图标icon。将这些icon整理在一张图片上，也可以将许多个http请求折中成一个http请求。利用background-image,background-position,background-repeat组合显示想要的icon。

    ![](https://github.com/shaniawei/resource/blob/master/images/8.jpg)

    **雪碧图的优点**

    - 减少了http请求数
    - 减少了图片总和的字节数(虽然增加了许多空白的区域，但是旨在减少颜色表……)
    - 便于更换网站风格

    **雪碧图的缺点**

    - 必须精确的知道某个icon的位置

  - 图片base64

    将图片数据转换成二进制数据，会将图片大小变大，适用于几px*几px的图片。

    **图片base64的优点**

    - 不需要http请求资源

    **图片base64的缺点**

    - 图片大小变大
    - 只能在外联css中作为背景图才能缓存

- css、js文件

  - 一个网页的外联css文件数尽量控制在2个以内


  - 小于2kb的css/js文件使用内联方式内嵌在html文档中
  - 生成环境下，可进行合并的js/css文件都合并，减少css/js文件数

第二，加快请求下载资源的速度。

首先通过查看Chrome开发工具的network面板中的**资源时间轴**可以清楚地了解请求某个资源完整的耗时信息。

打开资源时间轴的方式：

1. 将鼠标悬停到 Timeline 列下的耗时图表上。这将呈现一个显示完整耗时数据的弹出窗口。

   ![](https://github.com/shaniawei/resource/blob/master/images/time2.png)

2. 点击任何条目并打开该条目的 Timing 标签。

   ![](https://github.com/shaniawei/resource/blob/master/images/time.png)

了解下timeline里面这几个字段的意思。点击这里



































































































## **开发之前关于页面性能的规划**

## **如何查找页面加载过慢的原因**

首先了解chrome开发工具的network面板，最好通过[**官方文档**](https://developers.google.com/web/tools/chrome-devtools/)进行了解。(浏览器需要翻墙才可以访问)

### **了解 Resource Timing**

#### 进入resource timing的两种方式：

1. 将鼠标悬停到 Timeline 列下的耗时图表上。这将呈现一个显示完整耗时数据的弹出窗口。

   ![images text](https://github.com/shaniawei/resource/blob/master/images/time2.png)


1. 点击任何条目并打开该条目的 Timing 标签。

   ![images text](https://github.com/shaniawei/resource/blob/master/images/time.png)

[了解resource timing具体的字段意思及相关性能问题的解决方式](https://developers.google.com/web/tools/chrome-devtools/network-performance/understanding-resource-timing)



> ***主要关注点：***

- queueing --chrome http 1.x处理最大请求并发数为6 超过这一部分的请求需要等前6个请求有一半返回后才开始发送

  ![images text](https://github.com/shaniawei/resource/blob/master/images/4.png)

- waiting  --发送请求成功至客户端收到服务器返回的第一个字节

  ![images text](https://github.com/shaniawei/resource/blob/master/images/5.png)

- download/loading  --接收数据所需时间

  ![images text](https://github.com/shaniawei/resource/blob/master/images/6.png)

> ***对应的解决方式：***

- 进行[域分片](https://blog.stackpath.com/glossary/domain-sharding/)或者部署http2
- 排除网络差的原因，优化后台数据库查询等(本地看下是不是网络的原因)
- 将资源进行对应的压缩

### **此处疑问：**

1.域分片是什么意思？具体如何操作？

2.http 1.x与http2的联系与区别

## **页面性能优化的方式**

**减少HTTP请求**

1.图片

- ​	图片地图的方式

  ​		*区域定位必须准确*

```HTML
<img src="planets.jpg" border="0" usemap="#planetmap" alt="Planets" />
<map name="planetmap" id="planetmap">
  <area shape="circle" coords="180,139,14" href ="venus.html" alt="Venus" />
  <area shape="circle" coords="129,161,10" href ="mercur.html" alt="Mercury" />
  <area shape="rect" coords="0,0,110,260" href ="sun.html" alt="Sun" />
</map>
```

- ​	css sprites

  ​	*将小图标合并成大图标*

  ​	优点：1.减少图片字节

  ​		    2.减少http请求

  ​	缺点：1.对每个图标的定位必须准确

  ​		    2.  如需新增其他图标只能在尾部增加

  - 转换成图片based



- ​	字体图标

2.css js

​	可以合并的 css  js文件尽量合并

​	文件大小小于2kb的直接内联在script/style标签中

**精简css js代码**

​	删除无用的js css代码

​	注重代码的复用，灵活运用浏览器的缓存机制，将复用的css js文件缓存下来，加快加载速度

**js文件放在底部**

​	浏览器解析html文档是从上往下执行的。页面渲染完成前，如果在head中引入js文件会阻塞浏览器对body中的dom解析，导致页面延迟显示。

​	css文件放在head中，避免文档空白或者无样式页面的闪烁。

**使用内容分发网络CDN**

​	*优缺点以及实现机制*

**添加Expires**

**配置ETag**

**使Ajax可缓存**

**避免重定向**

**减少DNS查找**

**压缩打包整个项目**

**SSL/TLS协商的时间 https请求记得优化TLS**

**tcp链接在同意域名下保持长连接**



## **如何查找页面运行速度过慢的原因**



首先了解performance面板，之前叫时间线面板

要想运行速度加快，尽量避免重绘和重排。







开始渲染时间是用户首次从空白页面到看到页面加载出东西的时间

开始渲染时间一般不超过1.5s 超过这个时间就得优化



1.移动端最好使用小于100kb大小的图片
2.pc端最好使用小于200kb大小的图片
3.页面运行时的性能表现监测 链接：https://zhuanlan.zhihu.com/p/29879682
4.使用chrome开发工具的waterfall 查看页面加载的具体情况 根据不同的指标进行页面的优化
链接：https://www.cnblogs.com/shengulong/p/7449927.html
https://www.zhihu.com/question/27085552/answer/35194131

5.性能分析工具：http://www.mmtrix.com/evaluate/applist#



https://www.cnblogs.com/zhenwen/p/5827925.html



[什么？页面卡顿？操作慢？](https://juejin.im/entry/59a67ef06fb9a024903aba71)



- 使用 [PageSpeed Insights](https://developers.google.com/speed/pagespeed/insights) 确定可以应用到您网站的性能最佳做法，以及使用 [PageSpeed 优化工具](https://developers.google.com/speed/pagespeed/optimization)将应用这些最佳做法的流程自动化。

- [Google Chrome 中的高性能网络](https://www.igvita.com/posa/high-performance-networking-in-google-chrome/)讨论了 Chrome 网络内部机制，以及您如何充分利用它们让您的网站更快。

- [gzip 压缩的工作原理](https://developers.google.com/speed/articles/gzip)提供了 gzip 压缩的高级概览，并介绍了这种压缩为什么是一种不错的方法。

- [网页性能最佳做法](https://developers.google.com/speed/docs/best-practices/rules_intro)提供了更多用于优化您的网页或应用的网络性能的提示。

  ​

问题：

图片大小较大，加载时间较长，在不增加http请求+不放在cdn的情况下，如何压缩图片体积   加快加载速度？

1.文字区域尽量使用html代码编辑



